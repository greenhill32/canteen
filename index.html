<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Canteen Honesty System</title>
  <!-- Tailwind via CDN for quick styling; remove or self‑host in production -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 font-sans">
  <div class="max-w-md mx-auto mt-8 p-6 bg-white rounded-lg shadow-md">
    <!-- Logo -->
    <div class="text-center mb-4">
      <img src="logo.png" alt="Canteen Logo" class="mx-auto h-16 w-auto" onerror="this.style.display='none'">
    </div>
    
    <h1 class="text-2xl font-bold mb-2 text-center">Canteen Honesty System</h1>
    <p class="mb-4 text-center text-gray-600">Please record what you've taken from the canteen. This system runs on trust and good faith.</p>
    <form id="entryForm" class="space-y-4">
      <div>
        <label class="block font-medium mb-2">Items taken:</label>
        <div class="grid grid-cols-2 gap-3">
          <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition-colors">
            <input type="checkbox" name="items" value="Sandwich" class="form-checkbox h-4 w-4" />
            <span>Sandwich</span>
          </label>
          <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition-colors">
            <input type="checkbox" name="items" value="Drink" class="form-checkbox h-4 w-4" />
            <span>Drink</span>
          </label>
          <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition-colors">
            <input type="checkbox" name="items" value="Chocolate Bar" class="form-checkbox h-4 w-4" />
            <span>Chocolate Bar</span>
          </label>
          <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition-colors">
            <input type="checkbox" name="items" value="Pastry" class="form-checkbox h-4 w-4" />
            <span>Pastry</span>
          </label>
          <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition-colors">
            <input type="checkbox" name="items" value="Wrap" class="form-checkbox h-4 w-4" />
            <span>Wrap</span>
          </label>
          <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition-colors">
            <input type="checkbox" name="items" value="Protein Bar" class="form-checkbox h-4 w-4" />
            <span>Protein Bar</span>
          </label>
        </div>
        
        <!-- Misc/Unlisted Items Section -->
        <div class="mt-4 pt-4 border-t border-gray-200">
          <label class="block font-medium mb-2">Other/Unlisted Items:</label>
          <div class="space-y-2">
            <div class="flex items-center space-x-2">
              <input type="checkbox" id="miscCheckbox1" class="form-checkbox h-4 w-4" />
              <label for="miscCheckbox1" class="cursor-pointer">Other item</label>
            </div>
            <div id="miscText1" class="ml-6 hidden">
              <input type="text" id="miscInput1" placeholder="Describe the item..." maxlength="50" 
                     class="w-full p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
            </div>
            
            <div class="flex items-center space-x-2">
              <input type="checkbox" id="miscCheckbox2" class="form-checkbox h-4 w-4" />
              <label for="miscCheckbox2" class="cursor-pointer">Additional item</label>
            </div>
            <div id="miscText2" class="ml-6 hidden">
              <input type="text" id="miscInput2" placeholder="Describe the item..." maxlength="50" 
                     class="w-full p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
            </div>
            
            <div class="flex items-center space-x-2">
              <input type="checkbox" id="miscCheckbox3" class="form-checkbox h-4 w-4" />
              <label for="miscCheckbox3" class="cursor-pointer">Additional item</label>
            </div>
            <div id="miscText3" class="ml-6 hidden">
              <input type="text" id="miscInput3" placeholder="Describe the item..." maxlength="50" 
                     class="w-full p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
            </div>
          </div>
        </div>
      </div>
      <div>
        <label for="name" class="block font-medium mb-1">Your name:</label>
        <input id="name" name="name" type="text" maxlength="80" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Your name" />
      </div>
      <button type="submit" id="submitBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded disabled:opacity-50 disabled:cursor-not-allowed transform active:scale-95 transition-all duration-150">
        <span id="submitText">Log My Items</span>
        <span id="loadingText" class="hidden">Logging...</span>
      </button>
    </form>
    <div id="message" class="mt-4 text-center text-sm"></div>
  </div>
  <script>
    // Set your deployed Apps Script URL here. Keeping it in a single place
    // makes it easier to adjust between environments without editing logic.
    const API_URL = 'https://script.google.com/macros/s/AKfycbzlgPZ3ZsUW47s5jEticqAw75X09JdqVz45uzvd07WQJom4ZxbQSHc7nXMS3AYfHWTsrg/exec';

    const form = document.getElementById('entryForm');
    const message = document.getElementById('message');
    const submitBtn = document.getElementById('submitBtn');
    const submitText = document.getElementById('submitText');
    const loadingText = document.getElementById('loadingText');

    // Add visual feedback for checkbox selection
    const checkboxes = document.querySelectorAll('input[name="items"]');
    
    checkboxes.forEach(checkbox => {
      checkbox.addEventListener('change', function() {
        const label = this.closest('label');
        if (this.checked) {
          label.classList.add('bg-blue-50', 'border-blue-200', 'border');
          label.classList.remove('hover:bg-gray-50');
        } else {
          label.classList.remove('bg-blue-50', 'border-blue-200', 'border');
          label.classList.add('hover:bg-gray-50');
        }
      });
    });

    // Handle misc checkboxes and text inputs
    for (let i = 1; i <= 3; i++) {
      const checkbox = document.getElementById(`miscCheckbox${i}`);
      const textDiv = document.getElementById(`miscText${i}`);
      const textInput = document.getElementById(`miscInput${i}`);
      
      checkbox.addEventListener('change', function() {
        if (this.checked) {
          textDiv.classList.remove('hidden');
          textInput.focus();
          this.parentElement.classList.add('bg-blue-50', 'border-blue-200', 'border', 'rounded', 'p-2');
        } else {
          textDiv.classList.add('hidden');
          textInput.value = '';
          this.parentElement.classList.remove('bg-blue-50', 'border-blue-200', 'border', 'rounded', 'p-2');
        }
      });
    }

    form.addEventListener('submit', async (evt) => {
      evt.preventDefault();
      const name = document.getElementById('name').value.trim();
      const selected = Array.from(form.querySelectorAll('input[name="items"]:checked')).map(cb => cb.value);
      
      // Add misc items if selected and described
      for (let i = 1; i <= 3; i++) {
        const checkbox = document.getElementById(`miscCheckbox${i}`);
        const textInput = document.getElementById(`miscInput${i}`);
        if (checkbox.checked && textInput.value.trim()) {
          selected.push(textInput.value.trim());
        }
      }
      
      if (!name || selected.length === 0) {
        showMessage('Please enter your name and select at least one item.', 'error');
        return;
      }
      
      setLoading(true);
      message.textContent = '';
      
      const params = new URLSearchParams();
      params.append('action', 'log');
      params.append('name', name);
      params.append('items', selected.join(', ')); // Send as comma-separated string
      
      try {
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: params.toString(),
        });
        const result = await res.json();
        
        if (result.ok) {
          showMessage(`✅ Logged ${selected.length} item(s)! Thank you.`, 'success');
          form.reset();
          // Reset checkbox styling
          checkboxes.forEach(checkbox => {
            const label = checkbox.closest('label');
            label.classList.remove('bg-blue-50', 'border-blue-200', 'border');
            label.classList.add('hover:bg-gray-50');
          });
          // Reset misc sections
          for (let i = 1; i <= 3; i++) {
            const checkbox = document.getElementById(`miscCheckbox${i}`);
            const textDiv = document.getElementById(`miscText${i}`);
            const textInput = document.getElementById(`miscInput${i}`);
            checkbox.checked = false;
            textDiv.classList.add('hidden');
            textInput.value = '';
            checkbox.parentElement.classList.remove('bg-blue-50', 'border-blue-200', 'border', 'rounded', 'p-2');
          }
        } else {
          showMessage(result.message || 'An error occurred.', 'error');
        }
      } catch (err) {
        showMessage('Network error. Please try again.', 'error');
      } finally {
        setLoading(false);
      }
    });

    function setLoading(loading) {
      submitBtn.disabled = loading;
      if (loading) {
        submitText.classList.add('hidden');
        loadingText.classList.remove('hidden');
      } else {
        submitText.classList.remove('hidden');
        loadingText.classList.add('hidden');
      }
    }

    function showMessage(text, type = 'info') {
      message.textContent = text;
      message.className = 'mt-4 text-center text-sm ';
      
      if (type === 'success') {
        message.className += 'text-green-600 bg-green-50 p-2 rounded border border-green-200';
      } else if (type === 'error') {
        message.className += 'text-red-600 bg-red-50 p-2 rounded border border-red-200';
      } else {
        message.className += 'text-blue-600';
      }
      
      // Clear message after delay
      setTimeout(() => { 
        message.textContent = '';
        message.className = 'mt-4 text-center text-sm';
      }, 4000);
    }
  </script>
</body>
</html>